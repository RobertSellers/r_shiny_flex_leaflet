---
title: "Leaflet Choropleth + Flexdashboard + DT"
author: "Robert Sellers"
output:
  flexdashboard::flex_dashboard:
    theme: paper
    favicon: img/ios7-location-outline.png
runtime: shiny
---

```{r setup, include=FALSE}
library(dplyr)  # tidy data manipulation
library(leaflet)  # interative mapping
library(DT)  # interactive tables
library(sf) # Geospatial processing library
library(spData) # Geospatial datasets

# observe({
#   mapFiltered()
#   leafletProxy("map", data = us_states) %>%
#   addProviderTiles("CartoDB.Positron") %>% 
#   clearShapes() %>% 
#   #clearControls() %>% 
#   addPolygons(data = us_states, fillColor = 'red', fillOpacity = 0.7, 
#             color = "white", weight = 2) 
# })

observe({
  mapFiltered()
  renderDataTable(mapFiltered())
})
  
```

Column {data-width=400}
-------------------------------------
```{r}
radioButtons("category", "Select a variable:",
            choices = c('total_pop_10','total_pop_15'),
            selected = "total_pop_10")
```

### Variable Selection
    
```{r mytable}
renderDataTable({
  DT::datatable(
  mapFiltered(),
  filter = "top",
  extensions = "Scroller",
  rownames = FALSE,
  style = "bootstrap",
  class = "compact",
  width = "100%",
  options = list(deferRender = TRUE, scrollY = 300, scroller = TRUE))
})
```


Column {data-width=600}
-------------------------------------
    
### Choropleth map
    
```{r map}

mapFiltered  <- reactive({
  us_states[c("NAME",input$category)]
})

# renderText({
#   input$category
# })

renderLeaflet({
  if (nrow(mapFiltered()) == 0) {
    return(NULL)
  }

  leaflet(mapFiltered()) %>%
    addTiles() %>%
    setView(lng = 0, lat = 30, zoom = 2) %>%
    addPolygons(
      fillColor = sample(c("red","blue","green")),
      color = "white",
      fillOpacity = 0.7,
      #label = ~labels,
      highlight = highlightOptions(
        color = "black",
        bringToFront = TRUE
      )
    ) #%>%
    #leaflet::addLegend(
      #pal = pal, values = ~PM2.5,
      #opacity = 0.7, title = "PM2.5"
    #)
})

```